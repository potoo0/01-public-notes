############################# tmux config #############################
# : << EOF do not edit! 含义: 将 E-O-F 之间的重定向到 `:`, 也就是丢弃

# config path: /etc/tmux.conf, ~/.config/tmux/tmux.conf, ~/.tmux.conf
# set(set-option): 如果选项不是用户选项，则 -w 或 -s 可省略，tmux 会根据设置名称自动推断.
# setw: set -w 的简写
# bind(bind-key): 默认绑定到 prefix 表格中(相当于指定参数 -Tprefix), -N 用来写备注, 绑定多条命令时使用 \; 间隔(详见 命令语法)
# 命令语法: https://man7.org/linux/man-pages/man1/tmux.1.html#PARSING_SYNTAX

# --------------------------- general ---------------------------
set -g default-terminal "screen-256color" # 也会作为环境变量 TERM 的默认值
if 'infocmp -x tmux-256color > /dev/null 2>&1' 'set -g default-terminal "tmux-256color"'

set -g history-limit 100000 # default is 2000

set -g automatic-rename off # 禁止 window auto-rename(打开会在每次执行命令后尝试重命名)
set -g allow-rename off     # 禁止 pane 的程序修改 window 的名称
set -g renumber-windows on  # window 销毁后对 window 重新编号
set -g base-index 1         # window 编号起始为 1, default is 0
set -g pane-base-index 1    # pane 编号起始为 1

set -g focus-events on
set -g monitor-activity on
set -g visual-activity off

# set ctrl-a as secondary prefix key
set -g prefix2 C-a
bind -N 'secondary prefix key' C-a send-prefix -2

# prefix 按下以及鼠标模式 右下角提示, 以及修改时间格式为 15:16 23/02/24
# 原配置: `tmux display -p '#{status-right}'`
set -g status-right '#{?mouse,↖ | ,}#{?client_prefix,#[reverse]<C>#[noreverse] | ,}#{?window_bigger,[#{window_offset_x}#,#{window_offset_y}] | ,}"#{=21:pane_title}" | %H:%M %d/%m/%y'

# --------------------------- key table=root ---------------------------
bind -n -N 'clear screen and history' C-l   send-keys C-l \; run 'sleep 0.1' \; clear-history
# bind ctrl+tab for next-window.
#     mintty 需要关闭 *Switch window*
#     windows terminal 需要增加 actions: { "command": {"action": "sendInput", "input": "\u001b[27;5;9~"}, "keys": "ctrl+tab" }
%if #{MSYSTEM}
  set -s user-keys[0] "\e[1;5I"                           
  bind -nr -N 'next window'           User0 next-window
%else
  bind -nr -N 'next window'           C-Tab next-window
%endif

# --------------------------- key table=prefix ---------------------------
bind -N 'last window'                Tab last-window
bind -N 'create session'             C-c new-session
bind -N 'split-window horizontally'  -   split-window -v
bind -N 'split-window vertically'    _   split-window -h
bind -N 'toggle zoom'                +   resize-pane -Z
bind -N 'toggle mouse mode'          m   run '_s=$(echo 'onoff' | sed "s/$(tmux show -gv mouse)//"); tmux set -g mouse $_s \; display ">>mouse: $_s"'
bind -N 'cap pane history to file. var tmux_cap_size for spec starting line number' C-p run 'tmux_cap_file=$(tmux display -p "tmux-cap-#{session_name}-#{window_index}-#{pane_index}-%Y%m%d%H%M%S.log"); _size="#{?tmux_cap_size,#{tmux_cap_size},#{history_limit}}"; tmux capture-pane -pS -$_size > ~/$tmux_cap_file; tmux display "saved pane at lease -$_size history to $tmux_cap_file"'

# --------------------------- status bar ---------------------------
set -g display-time 2000                                    # 状态栏消息显示时间
set -g status-style                'fg=#8a8a8a,bg=#080808'  # 状态栏样式
set -g message-style               'fg=#ffff00,bg=#080808'  # 状态栏消息样式
set -g message-command-style       'fg=#ffff00,bg=#080808'  # 状态栏消息样式
set -g window-status-style         'fg=#00afff,bg=#303030'  # window 默认样式
set -g window-status-current-style 'fg=#080808,bg=#00afff'  # 当前激活 window 样式
set -g mode-style                  'fg=#080808,bg=#00afff'  # c-w(choose-tree) 的样式

# do not edit!
# EOF

############################### shell script ###############################
# set -e
# unset GREP_OPTIONS
# export LC_NUMERIC=C
#
# if ! printf '' | sed -E 's///' 2>/dev/null; then
#   if printf '' | sed -r 's///' 2>/dev/null; then
#     sed () {
#       n=$#; while [ "$n" -gt 0 ]; do arg=$1; shift; case $arg in -E*) arg=-r${arg#-E};; esac; set -- "$@" "$arg"; n=$(( n - 1 )); done
#       command sed "$@"
#     }
#   fi
# fi

# _uptime() {
# }

# # do not edit!, 用来 `sh -s` 执行指定函数
# "$@"
